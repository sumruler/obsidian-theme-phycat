name: Release Obsidian Theme

on:
  push:
    tags:
      - "[0-9]*" # å½“æ¨é€ä»¥æ•°å­—å¼€å¤´çš„æ ‡ç­¾æ—¶è§¦å‘ (ä¾‹å¦‚ 0.1.1)

permissions:
  contents: write # éœ€è¦å†™å…¥æƒé™æ¥åˆ›å»º Release

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. è·å–ç‰ˆæœ¬å·
      - name: Get version
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV

      # 3. å‡†å¤‡æ–‡ä»¶å¤¹ç»“æ„ (æ ¸å¿ƒä¿®æ”¹)
      # åˆ›å»º Phycat æ–‡ä»¶å¤¹ï¼ŒæŠŠæ–‡ä»¶å¤åˆ¶è¿›å»ï¼Œæ–¹ä¾¿ç”¨æˆ·è§£å‹å³ç”¨
      - name: Prepare folder structure
        run: |
          mkdir Phycat
          cp manifest.json theme.css Phycat/
          # å¦‚æœæœ‰ README æˆ– LICENSE ä¹Ÿå¯ä»¥å¤åˆ¶è¿›å»
          # cp README.md LICENSE Phycat/ 

      # 4. æ‰“åŒ…æ–‡ä»¶å¤¹ä¸º Zip
      - name: Zip folder
        run: |
          zip -r "obsidian-phycat-theme-${{ env.VERSION }}.zip" Phycat

      # 5. è·å– Commit ä¿¡æ¯
      - name: Get Commit Message
        id: get_commit_message
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)
          echo "COMMIT_MSG<<EOF" >> $GITHUB_ENV
          echo "$COMMIT_MSG" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      # 6. å‘å¸ƒ Release
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.VERSION }}
          name: Release ${{ env.VERSION }}
          body: |
            ## æ›´æ–°å†…å®¹
            
            ${{ env.COMMIT_MSG }}
            
            ---
            ### ğŸ“¦ å¦‚ä½•å®‰è£…
            1. ä¸‹è½½ `obsidian-phycat-theme-${{ env.VERSION }}.zip`ã€‚
            2. è§£å‹å¾—åˆ° `Phycat` æ–‡ä»¶å¤¹ã€‚
            3. å°†æ–‡ä»¶å¤¹æ”¾å…¥ä½ çš„ `.obsidian/themes/` ç›®å½•ä¸‹ã€‚
          files: |
            manifest.json
            theme.css
            obsidian-phycat-theme-${{ env.VERSION }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}